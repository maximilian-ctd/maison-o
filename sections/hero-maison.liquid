{%- liquid
  assign video_height = section.settings.video_height | default: 800
  assign overlay_opacity = section.settings.overlay_opacity | default: 30 | divided_by: 100.0
-%}

<section class="hero-maison" style="min-height: {{ video_height }}px;">
  <!-- Video Background -->
  {%- if section.settings.video_url != blank -%}
    <div class="hero-maison__video-wrapper">
      <video 
        class="hero-maison__video" 
        autoplay 
        muted 
        loop 
        playsinline
        {% if section.settings.video_poster != blank %}
          poster="{{ section.settings.video_poster | image_url: width: 1920 }}"
        {% endif %}
      >
        <source src="{{ section.settings.video_url }}" type="video/mp4">
        {%- if section.settings.fallback_image != blank -%}
          <img 
            src="{{ section.settings.fallback_image | image_url: width: 1920 }}" 
            alt="{{ section.settings.fallback_image.alt | escape }}"
            class="hero-maison__fallback-image"
          >
        {%- endif -%}
      </video>
      {%- if section.settings.show_overlay -%}
        <div class="hero-maison__overlay" style="opacity: {{ overlay_opacity }};"></div>
      {%- endif -%}
    </div>
  {%- elsif section.settings.fallback_image != blank -%}
    <div class="hero-maison__image-wrapper">
      <img 
        src="{{ section.settings.fallback_image | image_url: width: 1920 }}" 
        alt="{{ section.settings.fallback_image.alt | escape }}"
        class="hero-maison__fallback-image"
        loading="eager"
      >
      {%- if section.settings.show_overlay -%}
        <div class="hero-maison__overlay" style="opacity: {{ overlay_opacity }};"></div>
      {%- endif -%}
    </div>
  {%- endif -%}

  <!-- Top Right Text -->
  {%- if section.settings.top_right_text != blank -%}
    <button type="button" class="hero-maison__top-right-text" data-heyflow-modal>
      {{ section.settings.top_right_text }}
    </button>
  {%- endif -%}

  <!-- HeyFlow Modal -->
  <div class="hero-maison__heyflow-modal" data-heyflow-modal-container>
    <div class="hero-maison__heyflow-modal-overlay" data-heyflow-close></div>
    <div class="hero-maison__heyflow-modal-content">
      <button type="button" class="hero-maison__heyflow-modal-close" data-heyflow-close aria-label="Schließen">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
      <heyflow-wrapper flow-id="OXukvFlXlOj4Om7gpATS" dynamic-height scroll-up-on-navigation style-config='{"width":"800px"}'></heyflow-wrapper>
    </div>
  </div>

  <!-- Brand Logo -->
  <div class="hero-maison__brand">
    {%- if section.settings.brand_logo != blank -%}
      <div class="hero-maison__brand-logo-wrapper">
        <img 
          src="{{ section.settings.brand_logo | image_url: width: 1200 }}" 
          alt="{{ section.settings.brand_text | default: 'MAISON Ô' }}" 
          class="hero-maison__brand-logo"
          loading="eager"
        >
      </div>
    {%- elsif section.settings.brand_text != blank -%}
      <h1 class="hero-maison__brand-text">{{ section.settings.brand_text }}</h1>
    {%- endif -%}
  </div>

  <!-- Countdown zum Go-Live -->
  <div class="hero-maison__countdown" data-countdown>
    <div class="hero-maison__countdown-item">
      <span class="hero-maison__countdown-value" data-countdown-days>00</span>
      <span class="hero-maison__countdown-label">Tage</span>
    </div>
    <div class="hero-maison__countdown-separator">:</div>
    <div class="hero-maison__countdown-item">
      <span class="hero-maison__countdown-value" data-countdown-hours>00</span>
      <span class="hero-maison__countdown-label">Stunden</span>
    </div>
    <div class="hero-maison__countdown-separator">:</div>
    <div class="hero-maison__countdown-item">
      <span class="hero-maison__countdown-value" data-countdown-minutes>00</span>
      <span class="hero-maison__countdown-label">Minuten</span>
    </div>
    <div class="hero-maison__countdown-separator">:</div>
    <div class="hero-maison__countdown-item">
      <span class="hero-maison__countdown-value" data-countdown-seconds>00</span>
      <span class="hero-maison__countdown-label">Sekunden</span>
    </div>
  </div>


  <!-- Bottom Right Icon - Concierge -->
  {%- if section.settings.concierge_text != blank or section.settings.concierge_link != blank -%}
    <button type="button" class="hero-maison__concierge-icon" aria-label="{{ section.settings.concierge_text | default: 'Concierge' }}" data-concierge-chat>
      {%- if section.settings.concierge_icon != blank -%}
        <img 
          src="{{ section.settings.concierge_icon | image_url: width: 400 }}" 
          alt="{{ section.settings.concierge_text | default: 'Concierge' }}"
          class="hero-maison__concierge-icon-image"
        >
      {%- else -%}
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
          <circle cx="9" cy="7" r="4"></circle>
          <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
        </svg>
        {%- endif -%}
      </button>
    {%- endif -%}
</section>

<style>
  .hero-maison {
    position: sticky;
    top: 0;
    width: 100%;
    height: 100vh;
    min-height: 600px;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #1a1a1a;
    z-index: 10;
  }

  /* Video/Image Wrapper */
  .hero-maison__video-wrapper,
  .hero-maison__image-wrapper {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 0;
    overflow: hidden;
  }

  .hero-maison__video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
  }

  .hero-maison__fallback-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
  }

  /* Overlay - Sehr dunkel für atmosphärischen Effekt */
  .hero-maison__overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    z-index: 1;
  }

  /* Brand Logo - Unten zentriert, fließt in nächsten Abschnitt über */
  .hero-maison__brand {
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%) translateY(35%);
    z-index: 2;
    text-align: center;
    padding: 0 var(--spacing-lg);
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: flex-end;
    margin: 0;
  }

  .hero-maison__brand-logo-wrapper {
    max-width: 800px;
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: flex-end;
    transition: all 0.3s ease;
    position: relative;
    margin: 0;
    padding: 0;
  }

  .hero-maison__brand-logo-wrapper:hover {
    transform: scale(1.02);
  }

  .hero-maison__brand-logo {
    max-width: 100%;
    width: 100%;
    height: auto;
    object-fit: contain;
    display: block;
    margin: 0;
    padding: 0;
    vertical-align: bottom;
    /* Logo hat bereits die richtige Farbe - kein Filter nötig */
  }


  /* Fallback: Brand Text wenn kein Logo */
  .hero-maison__brand-text {
    font-family: 'Montserrat', var(--font-heading-family), -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    font-size: 8rem;
    font-weight: 900;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: #340000;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    line-height: 1.1;
    margin: 0;
  }

  /* Top Right Text */
  .hero-maison__top-right-text {
    font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    margin-top: -60px;
    z-index: 2;
    color: rgba(255, 255, 255, 0.85);
    font-size: 1.1rem;
    font-weight: 300;
    text-decoration: none;
    text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.4);
    transition: all 0.3s ease;
    cursor: pointer;
    letter-spacing: 0.02em;
    line-height: 1.5;
    background: transparent;
    border: none;
    padding: 0;
    text-align: center;
    white-space: nowrap;
  }

  .hero-maison__top-right-text:hover {
    color: rgba(255, 255, 255, 1);
    text-decoration: underline;
  }

  /* HeyFlow Modal */
  .hero-maison__heyflow-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
    pointer-events: none;
  }

  .hero-maison__heyflow-modal.is-open {
    opacity: 1;
    visibility: visible;
    pointer-events: all;
  }

  .hero-maison__heyflow-modal-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(5px);
  }

  .hero-maison__heyflow-modal-content {
    position: relative;
    background: #ffffff;
    padding: 0;
    border-radius: 8px;
    max-width: 800px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    transform: scale(0.9);
    transition: transform 0.3s ease;
    z-index: 1;
  }

  .hero-maison__heyflow-modal.is-open .hero-maison__heyflow-modal-content {
    transform: scale(1);
  }

  .hero-maison__heyflow-modal-close {
    position: absolute;
    top: 16px;
    right: 16px;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255, 255, 255, 0.9);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    color: #000000;
    transition: all 0.3s ease;
    padding: 0;
    z-index: 10;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  }

  .hero-maison__heyflow-modal-close:hover {
    background: rgba(255, 255, 255, 1);
    transform: scale(1.1);
  }

  .hero-maison__heyflow-modal-close svg {
    width: 20px;
    height: 20px;
  }

  .hero-maison__heyflow-modal-content heyflow-wrapper {
    display: block;
    width: 100%;
    min-height: 400px;
  }

  @media (max-width: 767px) {
    .hero-maison__heyflow-modal {
      padding: 10px;
    }

    .hero-maison__heyflow-modal-content {
      max-width: 100%;
      width: 100%;
      max-height: 95vh;
      border-radius: 0;
      margin: 0;
      transform: scale(1);
    }

    .hero-maison__heyflow-modal-content heyflow-wrapper {
      min-height: 300px;
      width: 100% !important;
      max-width: 100% !important;
    }

    .hero-maison__heyflow-modal-close {
      top: 10px;
      right: 10px;
      width: 36px;
      height: 36px;
      background: rgba(255, 255, 255, 1);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    .hero-maison__heyflow-modal-close svg {
      width: 18px;
      height: 18px;
    }
  }

  @media (max-width: 480px) {
    .hero-maison__heyflow-modal {
      padding: 0;
    }

    .hero-maison__heyflow-modal-content {
      max-width: 100%;
      width: 100%;
      max-height: 100vh;
      border-radius: 0;
      height: 100vh;
    }

    .hero-maison__heyflow-modal-content heyflow-wrapper {
      min-height: 250px;
      width: 100% !important;
      max-width: 100% !important;
    }

    .hero-maison__heyflow-modal-close {
      top: 8px;
      right: 8px;
      width: 40px;
      height: 40px;
    }
  }

  @media (max-width: 1023px) {
    .hero-maison {
      min-height: 500px;
      height: 80vh;
    }

    .hero-maison__brand {
      transform: translateX(-50%) translateY(30%);
      padding: 0 var(--spacing-md);
    }

    .hero-maison__brand-logo-wrapper {
      max-width: 550px;
    }

    .hero-maison__brand-text {
      font-size: 5rem;
    }

    .hero-maison__top-right-text {
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      margin-top: -50px;
      font-size: 1rem;
      text-align: center;
    }

    .hero-maison__countdown {
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      margin-top: 15px;
      padding: 8px 16px;
      gap: 0.35rem;
    }

    .hero-maison__countdown-value {
      font-size: 0.75rem;
    }

    .hero-maison__countdown-item:hover .hero-maison__countdown-value {
      font-size: 1.5rem;
    }

    .hero-maison__countdown-label {
      font-size: 0.35rem;
    }

    .hero-maison__countdown-separator {
      font-size: 0.65rem;
    }

    .hero-maison__concierge-icon {
      bottom: 25px;
      right: 25px;
      width: 90px;
      height: 90px;
    }
  }

  /* Countdown zum Go-Live */
  .hero-maison__countdown {
    font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    margin-top: 20px;
    z-index: 2;
    color: #ffffff;
    display: flex;
    align-items: center;
    gap: 0.4rem;
    padding: 8px 16px;
    text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.8), 0 0 20px rgba(0, 0, 0, 0.5);
  }

  .hero-maison__countdown-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.2rem;
    cursor: pointer;
    transition: transform 0.3s ease;
  }

  .hero-maison__countdown-item:hover {
    transform: translateY(-2px);
  }

  .hero-maison__countdown-value {
    font-size: 0.9rem;
    font-weight: 600;
    line-height: 1;
    letter-spacing: 0.05em;
    transition: font-size 0.3s ease, transform 0.3s ease;
  }

  .hero-maison__countdown-item:hover .hero-maison__countdown-value {
    font-size: 1.8rem;
    transform: scale(1.1);
  }

  .hero-maison__countdown-label {
    font-size: 0.4rem;
    font-weight: 400;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    opacity: 0.9;
    transition: opacity 0.3s ease;
  }

  .hero-maison__countdown-item:hover .hero-maison__countdown-label {
    opacity: 1;
  }

  .hero-maison__countdown-separator {
    font-size: 0.75rem;
    font-weight: 300;
    opacity: 0.7;
    padding: 0 0.2rem;
    transition: opacity 0.3s ease;
  }

  @media (max-width: 1023px) {
    .hero-maison__countdown {
      bottom: 25px;
      left: 25px;
      padding: 10px 20px;
      gap: 0.4rem;
    }

    .hero-maison__countdown-value {
      font-size: 0.9rem;
    }

    .hero-maison__countdown-item:hover .hero-maison__countdown-value {
      font-size: 1.8rem;
    }

    .hero-maison__countdown-label {
      font-size: 0.4rem;
    }

    .hero-maison__countdown-separator {
      font-size: 0.75rem;
    }
  }

  /* Bottom Right Icon - Concierge */
  @keyframes concierge-pulse {
    0% {
      transform: scale(1);
      box-shadow: 0 4px 12px rgba(52, 0, 0, 0.5);
    }
    50% {
      transform: scale(1.03);
      box-shadow: 0 4px 12px rgba(52, 0, 0, 0.6), 0 0 0 6px rgba(52, 0, 0, 0);
    }
    100% {
      transform: scale(1);
      box-shadow: 0 4px 12px rgba(52, 0, 0, 0.5);
    }
  }

  @keyframes concierge-pulse-ring {
    0% {
      opacity: 0.5;
      transform: translate(-50%, -50%) scale(1);
    }
    100% {
      opacity: 0;
      transform: translate(-50%, -50%) scale(1.3);
    }
  }

  .hero-maison__concierge-icon {
    position: absolute;
    bottom: 30px;
    right: 30px;
    z-index: 2;
    width: 100px;
    height: 100px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: rgba(255, 255, 255, 1);
    border: 2px solid rgba(255, 255, 255, 0.8);
    border-radius: 50%;
    background: rgba(52, 0, 0, 0.8);
    backdrop-filter: blur(10px);
    transition: all 0.3s ease;
    cursor: grab;
    user-select: none;
    touch-action: none;
    text-decoration: none;
    box-shadow: 0 4px 12px rgba(52, 0, 0, 0.5);
    animation: concierge-pulse 3s ease-in-out infinite;
    padding: 0;
  }

  .hero-maison__concierge-icon::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    border: 2px solid rgba(255, 255, 255, 0.3);
    transform: translate(-50%, -50%);
    animation: concierge-pulse-ring 3s ease-out infinite;
    pointer-events: none;
  }

  .hero-maison__concierge-icon-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center center;
    border-radius: 50%;
    opacity: 1;
    transition: all 0.3s ease;
  }

  .hero-maison__concierge-icon svg {
    width: 28px;
    height: 28px;
    stroke: currentColor;
  }

  .hero-maison__concierge-icon:hover {
    color: rgba(255, 255, 255, 1);
    border-color: rgba(255, 255, 255, 1);
    background: rgba(52, 0, 0, 0.95);
    transform: translateY(-3px) scale(1.1);
    box-shadow: 0 8px 24px rgba(52, 0, 0, 0.6), 0 0 30px rgba(255, 255, 255, 0.3);
    animation: none;
  }

  .hero-maison__concierge-icon:hover .hero-maison__concierge-icon-image {
    opacity: 1;
    transform: scale(1.15);
  }


    .hero-maison {
      min-height: 100vh;
      height: 100vh;
      overflow: visible;
    }

    .hero-maison__brand {
      transform: translateX(-50%) translateY(35%);
      left: 50%;
      right: auto;
      padding: 0 var(--spacing-lg);
      margin: 0;
      width: 100%;
      position: absolute;
      bottom: 0;
      text-align: center;
      align-items: flex-end;
    }

    .hero-maison__brand-logo-wrapper {
      max-width: 380px;
      padding: 0;
      margin: 0 auto;
      overflow: visible;
      align-items: flex-end;
    }

    .hero-maison__brand-logo {
      display: block;
      margin: 0;
      padding: 0;
      vertical-align: bottom;
    }

    .hero-maison__brand-text {
      font-size: 2.8rem;
      letter-spacing: 0.05em;
      line-height: 1.2;
      text-align: left;
    }

    .hero-maison__top-right-text {
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      margin-top: -40px;
      font-size: 0.85rem;
      max-width: 90%;
      text-align: center;
      line-height: 1.4;
      white-space: normal;
    }

    .hero-maison__countdown {
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      margin-top: 12px;
      padding: 6px 12px;
      gap: 0.25rem;
      z-index: 3;
    }

    .hero-maison__countdown-value {
      font-size: 0.7rem;
    }

    .hero-maison__countdown-item:hover .hero-maison__countdown-value {
      font-size: 1.4rem;
    }

    .hero-maison__countdown-label {
      font-size: 0.3rem;
    }

    .hero-maison__countdown-separator {
      font-size: 0.6rem;
    }

    .hero-maison__concierge-icon {
      bottom: 60px;
      right: 20px;
      left: auto;
      width: 75px;
      height: 75px;
      border-width: 1.5px;
      position: absolute;
      z-index: 3;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .hero-maison__concierge-icon-image {
      width: 100%;
      height: 100%;
    }

    .hero-maison__concierge-icon svg {
      width: 20px;
      height: 20px;
    }
  }

  @media (max-width: 480px) {
    .hero-maison {
      min-height: 100vh;
      height: 100vh;
      overflow: visible;
    }

    .hero-maison__brand {
      transform: translateX(-50%) translateY(35%);
      left: 50%;
      right: auto;
      padding: 0 var(--spacing-lg);
      margin: 0;
      width: 100%;
      position: absolute;
      bottom: 0;
      text-align: center;
      align-items: flex-end;
    }

    .hero-maison__brand-logo-wrapper {
      max-width: 320px;
      padding: 0;
      margin: 0 auto;
      overflow: visible;
      align-items: flex-end;
    }

    .hero-maison__brand-logo {
      display: block;
      margin: 0;
      padding: 0;
      vertical-align: bottom;
    }

    .hero-maison__brand-text {
      font-size: 2.2rem;
      letter-spacing: 0.03em;
      text-align: left;
    }

    .hero-maison__top-right-text {
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      margin-top: -35px;
      font-size: 0.75rem;
      max-width: 90%;
      text-align: center;
      white-space: normal;
    }

    .hero-maison__countdown {
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      margin-top: 10px;
      padding: 5px 10px;
      gap: 0.2rem;
      z-index: 3;
    }

    .hero-maison__countdown-value {
      font-size: 0.65rem;
    }

    .hero-maison__countdown-item:hover .hero-maison__countdown-value {
      font-size: 1.3rem;
    }

    .hero-maison__countdown-label {
      font-size: 0.28rem;
    }

    .hero-maison__countdown-separator {
      font-size: 0.55rem;
    }

    .hero-maison__concierge-icon {
      bottom: 50px;
      right: 15px;
      left: auto;
      width: 65px;
      height: 65px;
      position: absolute;
      z-index: 3;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .hero-maison__concierge-icon-image {
      width: 100%;
      height: 100%;
    }
  }

</style>

<script>
  (function() {
    const conciergeButton = document.querySelector('[data-concierge-chat]');
    const heroSection = document.querySelector('.hero-maison');
    
    if (!conciergeButton || !heroSection) return;
    
    // Funktion zum Prüfen ob Desktop-Ansicht
    function isDesktop() {
      return window.matchMedia('(min-width: 768px)').matches;
    }
    
    // Gespeicherte Position nur auf Desktop laden
    if (isDesktop()) {
      const savedPosition = localStorage.getItem('concierge-widget-position');
      if (savedPosition) {
        try {
          const pos = JSON.parse(savedPosition);
          conciergeButton.style.left = pos.left;
          conciergeButton.style.right = pos.right;
          conciergeButton.style.top = pos.top;
          conciergeButton.style.bottom = pos.bottom;
        } catch (e) {
          // console.error('Fehler beim Laden der Widget-Position:', e);
        }
      }
    } else {
      // Auf Mobile: Standard-Position verwenden (wird durch CSS gesetzt)
      // Wichtig: Alle inline-Styles entfernen, damit CSS greift
      conciergeButton.removeAttribute('style');
    }
    
    // Bei Fenstergrößenänderung prüfen
    let resizeTimeout;
    window.addEventListener('resize', function() {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(function() {
        if (!isDesktop()) {
          // Auf Mobile: Standard-Position verwenden
          conciergeButton.removeAttribute('style');
        }
      }, 250);
    });
    
    // Drag-Funktionalität
    let isDragging = false;
    let startX, startY, initialLeft, initialTop, initialRight, initialBottom;
    let hasMoved = false;
    
    function getPosition(element) {
      const rect = element.getBoundingClientRect();
      const heroRect = heroSection.getBoundingClientRect();
      return {
        left: rect.left - heroRect.left,
        top: rect.top - heroRect.top,
        right: heroRect.right - rect.right,
        bottom: heroRect.bottom - rect.bottom
      };
    }
    
      function setPosition(element, left, top) {
        // Nur auf Desktop Position speichern
        if (!isDesktop()) return;
        
        const heroRect = heroSection.getBoundingClientRect();
        const elementRect = element.getBoundingClientRect();
        const maxLeft = heroRect.width - elementRect.width;
        const maxTop = heroRect.height - elementRect.height;
        
        left = Math.max(0, Math.min(left, maxLeft));
        top = Math.max(0, Math.min(top, maxTop));
        
        element.style.left = left + 'px';
        element.style.top = top + 'px';
        element.style.right = 'auto';
        element.style.bottom = 'auto';
        
        // Position nur auf Desktop speichern
        localStorage.setItem('concierge-widget-position', JSON.stringify({
          left: left + 'px',
          top: top + 'px',
          right: 'auto',
          bottom: 'auto'
        }));
      }
    
    // Maus-Events (nur auf Desktop)
    conciergeButton.addEventListener('mousedown', function(e) {
      if (e.button !== 0 || !isDesktop()) return; // Nur linke Maustaste und nur auf Desktop
      isDragging = true;
      hasMoved = false;
      startX = e.clientX;
      startY = e.clientY;
      
      const pos = getPosition(conciergeButton);
      initialLeft = pos.left;
      initialTop = pos.top;
      
      conciergeButton.style.cursor = 'grabbing';
      conciergeButton.style.transition = 'none';
      e.preventDefault();
    });
    
    document.addEventListener('mousemove', function(e) {
      if (!isDragging) return;
      
      const deltaX = e.clientX - startX;
      const deltaY = e.clientY - startY;
      
      if (Math.abs(deltaX) > 5 || Math.abs(deltaY) > 5) {
        hasMoved = true;
      }
      
      const heroRect = heroSection.getBoundingClientRect();
      const newLeft = initialLeft + deltaX;
      const newTop = initialTop + deltaY;
      
      setPosition(conciergeButton, newLeft, newTop);
    });
    
    document.addEventListener('mouseup', function(e) {
      if (!isDragging) return;
      
      isDragging = false;
      conciergeButton.style.cursor = 'grab';
      conciergeButton.style.transition = 'all 0.3s ease';
      
      // Nur Chat öffnen, wenn nicht verschoben wurde
      if (!hasMoved) {
        e.preventDefault();
        
        // Shopify Chat öffnen
        const welcomeMessage = "Bienvenue a la Maison Ô, treten Sie ein in unsere Maison, wo Luxus, Raffinesse und Mode à la française auf Sie warten – in das univers raffiné, in dem jede Kollektion ihre eigene Geschichte trägt.";
        
        if (typeof Shopify !== 'undefined' && Shopify.chat) {
          Shopify.chat.open();
          // Nachricht nach kurzer Verzögerung senden, damit der Chat geöffnet ist
          setTimeout(function() {
            if (Shopify.chat && Shopify.chat.sendMessage) {
              Shopify.chat.sendMessage(welcomeMessage);
            } else {
              // Alternative: Nachricht über Input-Feld senden
              const chatInput = document.querySelector('[data-chat-input]') || 
                               document.querySelector('.chat-input') ||
                               document.querySelector('input[type="text"][placeholder*="chat" i]');
              if (chatInput) {
                chatInput.value = welcomeMessage;
                const sendButton = chatInput.closest('form')?.querySelector('button[type="submit"]') ||
                                 chatInput.nextElementSibling;
                if (sendButton) {
                  sendButton.click();
                }
              }
            }
          }, 500);
        } else if (window.Shopify && window.Shopify.chat) {
          window.Shopify.chat.open();
          setTimeout(function() {
            if (window.Shopify.chat && window.Shopify.chat.sendMessage) {
              window.Shopify.chat.sendMessage(welcomeMessage);
            }
          }, 500);
        } else {
          // Fallback: Nach Shopify Chat Widget suchen und öffnen
          const chatWidget = document.querySelector('[data-shopify-chat]') || 
                            document.querySelector('.shopify-chat') ||
                            document.querySelector('#chat-widget');
          
          if (chatWidget) {
            chatWidget.click();
            setTimeout(function() {
              const chatInput = document.querySelector('[data-chat-input]') || 
                               document.querySelector('.chat-input') ||
                               document.querySelector('input[type="text"][placeholder*="chat" i]');
              if (chatInput) {
                chatInput.value = welcomeMessage;
                const sendButton = chatInput.closest('form')?.querySelector('button[type="submit"]') ||
                                 chatInput.nextElementSibling;
                if (sendButton) {
                  sendButton.click();
                }
              }
            }, 500);
          } else {
            // Alternative: Chat-Bubble suchen und klicken
            const chatBubble = document.querySelector('[data-chat-bubble]') ||
                              document.querySelector('.chat-bubble') ||
                              document.querySelector('[aria-label*="chat" i]');
            
            if (chatBubble) {
              chatBubble.click();
              setTimeout(function() {
                const chatInput = document.querySelector('[data-chat-input]') || 
                                 document.querySelector('.chat-input') ||
                                 document.querySelector('input[type="text"][placeholder*="chat" i]');
                if (chatInput) {
                  chatInput.value = welcomeMessage;
                  const sendButton = chatInput.closest('form')?.querySelector('button[type="submit"]') ||
                                   chatInput.nextElementSibling;
                  if (sendButton) {
                    sendButton.click();
                  }
                }
              }, 500);
            } else {
              // console.log('Shopify Chat nicht gefunden. Bitte stellen Sie sicher, dass Shopify Chat aktiviert ist.');
            }
          }
        }
      }
    });
    
    // Touch-Events für mobile Geräte
    conciergeButton.addEventListener('touchstart', function(e) {
      isDragging = true;
      hasMoved = false;
      const touch = e.touches[0];
      startX = touch.clientX;
      startY = touch.clientY;
      
      const pos = getPosition(conciergeButton);
      initialLeft = pos.left;
      initialTop = pos.top;
      
      conciergeButton.style.transition = 'none';
      e.preventDefault();
    }, { passive: false });
    
    document.addEventListener('touchmove', function(e) {
      if (!isDragging) return;
      
      const touch = e.touches[0];
      const deltaX = touch.clientX - startX;
      const deltaY = touch.clientY - startY;
      
      if (Math.abs(deltaX) > 5 || Math.abs(deltaY) > 5) {
        hasMoved = true;
      }
      
      const heroRect = heroSection.getBoundingClientRect();
      const newLeft = initialLeft + deltaX;
      const newTop = initialTop + deltaY;
      
      setPosition(conciergeButton, newLeft, newTop);
      e.preventDefault();
    }, { passive: false });
    
    document.addEventListener('touchend', function(e) {
      if (!isDragging) return;
      
      isDragging = false;
      conciergeButton.style.transition = 'all 0.3s ease';
      
      // Nur Chat öffnen, wenn nicht verschoben wurde
      if (!hasMoved) {
        e.preventDefault();
        
        // Shopify Chat öffnen
        const welcomeMessage = "Bienvenue a la Maison Ô, treten Sie ein in unsere Maison, wo Luxus, Raffinesse und Mode à la française auf Sie warten – in das univers raffiné, in dem jede Kollektion ihre eigene Geschichte trägt.";
        
        if (typeof Shopify !== 'undefined' && Shopify.chat) {
          Shopify.chat.open();
          // Nachricht nach kurzer Verzögerung senden, damit der Chat geöffnet ist
          setTimeout(function() {
            if (Shopify.chat && Shopify.chat.sendMessage) {
              Shopify.chat.sendMessage(welcomeMessage);
            } else {
              // Alternative: Nachricht über Input-Feld senden
              const chatInput = document.querySelector('[data-chat-input]') || 
                               document.querySelector('.chat-input') ||
                               document.querySelector('input[type="text"][placeholder*="chat" i]');
              if (chatInput) {
                chatInput.value = welcomeMessage;
                const sendButton = chatInput.closest('form')?.querySelector('button[type="submit"]') ||
                                 chatInput.nextElementSibling;
                if (sendButton) {
                  sendButton.click();
                }
              }
            }
          }, 500);
        } else if (window.Shopify && window.Shopify.chat) {
          window.Shopify.chat.open();
          setTimeout(function() {
            if (window.Shopify.chat && window.Shopify.chat.sendMessage) {
              window.Shopify.chat.sendMessage(welcomeMessage);
            }
          }, 500);
        } else {
          // Fallback: Nach Shopify Chat Widget suchen und öffnen
          const chatWidget = document.querySelector('[data-shopify-chat]') || 
                            document.querySelector('.shopify-chat') ||
                            document.querySelector('#chat-widget');
          
          if (chatWidget) {
            chatWidget.click();
            setTimeout(function() {
              const chatInput = document.querySelector('[data-chat-input]') || 
                               document.querySelector('.chat-input') ||
                               document.querySelector('input[type="text"][placeholder*="chat" i]');
              if (chatInput) {
                chatInput.value = welcomeMessage;
                const sendButton = chatInput.closest('form')?.querySelector('button[type="submit"]') ||
                                 chatInput.nextElementSibling;
                if (sendButton) {
                  sendButton.click();
                }
              }
            }, 500);
          } else {
            // Alternative: Chat-Bubble suchen und klicken
            const chatBubble = document.querySelector('[data-chat-bubble]') ||
                              document.querySelector('.chat-bubble') ||
                              document.querySelector('[aria-label*="chat" i]');
            
            if (chatBubble) {
              chatBubble.click();
              setTimeout(function() {
                const chatInput = document.querySelector('[data-chat-input]') || 
                                 document.querySelector('.chat-input') ||
                                 document.querySelector('input[type="text"][placeholder*="chat" i]');
                if (chatInput) {
                  chatInput.value = welcomeMessage;
                  const sendButton = chatInput.closest('form')?.querySelector('button[type="submit"]') ||
                                   chatInput.nextElementSibling;
                  if (sendButton) {
                    sendButton.click();
                  }
                }
              }, 500);
            } else {
              // console.log('Shopify Chat nicht gefunden. Bitte stellen Sie sicher, dass Shopify Chat aktiviert ist.');
            }
          }
        }
      }
    });
  })();

  // Hero-Section nicht mehr sticky, wenn Footer erreicht wird
  (function() {
    const heroSection = document.querySelector('.hero-maison');
    const footer = document.querySelector('.footer');
    
    if (!heroSection || !footer) return;
    
    function checkFooterPosition() {
      const footerRect = footer.getBoundingClientRect();
      const viewportHeight = window.innerHeight;
      
      // Wenn Footer im Viewport sichtbar ist, Hero-Section nicht mehr sticky machen
      if (footerRect.top < viewportHeight) {
        heroSection.style.position = 'relative';
      } else {
        heroSection.style.position = 'sticky';
      }
    }
    
    // Initial check
    checkFooterPosition();
    
    // Bei Scroll prüfen
    window.addEventListener('scroll', checkFooterPosition, { passive: true });
    window.addEventListener('resize', checkFooterPosition);
    
    // Intersection Observer für präzisere Erkennung
    const observer = new IntersectionObserver(function(entries) {
      entries.forEach(function(entry) {
        if (entry.isIntersecting) {
          // Footer ist sichtbar - Hero nicht mehr sticky
          heroSection.style.position = 'relative';
        } else {
          // Footer ist nicht sichtbar - Hero wieder sticky
          if (entry.boundingClientRect.top > window.innerHeight) {
            heroSection.style.position = 'sticky';
          }
        }
      });
    }, {
      threshold: [0, 0.1, 0.5, 1],
      rootMargin: '0px'
    });
    
    observer.observe(footer);
  })();

  // Countdown zum Go-Live
  (function() {
    const countdownElement = document.querySelector('[data-countdown]');
    if (!countdownElement) return;

    // Ziel-Datum: 15. Januar 2026, 00:00:00 Uhr
    const targetDate = new Date('2026-01-15T00:00:00').getTime();

    function updateCountdown() {
      const now = new Date().getTime();
      const distance = targetDate - now;

      if (distance < 0) {
        // Countdown abgelaufen
        countdownElement.innerHTML = '<div class="hero-maison__countdown-item"><span class="hero-maison__countdown-value">Go-Live!</span></div>';
        return;
      }

      const days = Math.floor(distance / (1000 * 60 * 60 * 24));
      const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((distance % (1000 * 60)) / 1000);

      const daysElement = countdownElement.querySelector('[data-countdown-days]');
      const hoursElement = countdownElement.querySelector('[data-countdown-hours]');
      const minutesElement = countdownElement.querySelector('[data-countdown-minutes]');
      const secondsElement = countdownElement.querySelector('[data-countdown-seconds]');

      if (daysElement) daysElement.textContent = String(days).padStart(2, '0');
      if (hoursElement) hoursElement.textContent = String(hours).padStart(2, '0');
      if (minutesElement) minutesElement.textContent = String(minutes).padStart(2, '0');
      if (secondsElement) secondsElement.textContent = String(seconds).padStart(2, '0');
    }

    // Sofort aktualisieren
    updateCountdown();

    // Dann jede Sekunde aktualisieren
    setInterval(updateCountdown, 1000);
  })();

  // HeyFlow Modal
  (function() {
    const heyflowButton = document.querySelector('[data-heyflow-modal]');
    const heyflowModal = document.querySelector('[data-heyflow-modal-container]');
    const closeButtons = document.querySelectorAll('[data-heyflow-close]');
    
    if (!heyflowButton || !heyflowModal) return;
    
    // Modal öffnen
    heyflowButton.addEventListener('click', function(e) {
      e.preventDefault();
      heyflowModal.classList.add('is-open');
      document.body.style.overflow = 'hidden';
    });
    
    // Modal schließen
    closeButtons.forEach(button => {
      button.addEventListener('click', function(e) {
        e.preventDefault();
        heyflowModal.classList.remove('is-open');
        document.body.style.overflow = '';
      });
    });
    
    // Modal schließen bei ESC-Taste
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && heyflowModal.classList.contains('is-open')) {
        heyflowModal.classList.remove('is-open');
        document.body.style.overflow = '';
      }
    });
  })();
</script>

{% schema %}
{
  "name": "Hero Maison",
  "settings": [
    {
      "type": "header",
      "content": "Top Right Text"
    },
    {
      "type": "text",
      "id": "top_right_text",
      "label": "Text oben rechts",
      "default": "Sichern Sie sich Ihren exklusiven Platz"
    },
    {
      "type": "header",
      "content": "Video"
    },
    {
      "type": "text",
      "id": "video_url",
      "label": "Video URL",
      "info": "URL zum Video (z.B. von Shopify Files oder externer Hosting-Service). Unterstützt MP4 Format."
    },
    {
      "type": "image_picker",
      "id": "video_poster",
      "label": "Video Poster Bild",
      "info": "Vorschaubild, das angezeigt wird, während das Video lädt"
    },
    {
      "type": "image_picker",
      "id": "fallback_image",
      "label": "Fallback Bild",
      "info": "Wird angezeigt, wenn kein Video vorhanden ist"
    },
    {
      "type": "header",
      "content": "Brand Logo"
    },
    {
      "type": "image_picker",
      "id": "brand_logo",
      "label": "Logo Bild",
      "info": "Logo wird angezeigt und automatisch in #34000 eingefärbt. Falls kein Logo hochgeladen wird, wird der Text verwendet."
    },
    {
      "type": "text",
      "id": "brand_text",
      "label": "Brand Text (Fallback)",
      "default": "MAISON Ô",
      "info": "Wird nur angezeigt, wenn kein Logo hochgeladen wurde"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "video_height",
      "label": "Höhe (Desktop)",
      "min": 400,
      "max": 1200,
      "step": 50,
      "default": 800,
      "unit": "px"
    },
    {
      "type": "checkbox",
      "id": "show_overlay",
      "label": "Overlay anzeigen",
      "default": true,
      "info": "Dunkler Overlay über dem Video für bessere Textlesbarkeit"
    },
    {
      "type": "range",
      "id": "overlay_opacity",
      "label": "Overlay Opacity",
      "min": 0,
      "max": 80,
      "step": 5,
      "default": 30,
      "unit": "%",
      "info": "Nur sichtbar wenn Overlay aktiviert ist"
    },
    {
      "type": "header",
      "content": "Concierge Link"
    },
    {
      "type": "image_picker",
      "id": "concierge_icon",
      "label": "Concierge Bild",
      "info": "Bild für den Concierge-Button (rechts unten) - wird als runder Ausschnitt angezeigt"
    },
    {
      "type": "text",
      "id": "concierge_text",
      "label": "Concierge Text",
      "default": "Concierge"
    },
    {
      "type": "url",
      "id": "concierge_link",
      "label": "Concierge Link URL"
    }
  ],
  "presets": [
    {
      "name": "Hero Maison"
    }
  ]
}
{% endschema %}



