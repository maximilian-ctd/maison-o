<section class="heyflow-form section">
  <div class="container">
    <div class="heyflow-form__wrapper">
      {%- if section.settings.heading != blank -%}
        <h2 class="heyflow-form__heading">{{ section.settings.heading }}</h2>
      {%- endif -%}
      
      {%- if section.settings.flow_id != blank -%}
        <div class="heyflow-form__container" style="background-color: #ffffff; padding: 40px; border-radius: 0;">
          <heyflow-wrapper 
            flow-id="{{ section.settings.flow_id }}" 
            dynamic-height 
            scroll-up-on-navigation 
            style-config='{"width":"{{ section.settings.form_width | default: '800px' }}","backgroundColor":"#ffffff","background":"#ffffff","theme":"light"}' 
            class="heyflow-form__embed">
          </heyflow-wrapper>
        </div>
      {%- else -%}
        <div class="heyflow-form__placeholder">
          <p>Bitte Flow-ID in den Theme-Einstellungen konfigurieren.</p>
        </div>
      {%- endif -%}
    </div>
  </div>
</section>

<script>
  // Versuche, den HeyFlow-Hintergrund über JavaScript zu ändern
  (function() {
    function setHeyFlowBackground() {
      const heyflowWrapper = document.querySelector('heyflow-wrapper');
      if (heyflowWrapper) {
        // Warte auf das Laden des Widgets
        setTimeout(function() {
          const iframe = heyflowWrapper.querySelector('iframe');
          if (iframe) {
            try {
              // Versuche, auf den iframe-Inhalt zuzugreifen (funktioniert nur bei gleicher Domain)
              const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
              if (iframeDoc) {
                iframeDoc.body.style.backgroundColor = '#ffffff';
                iframeDoc.body.style.background = '#ffffff';
              }
            } catch (e) {
              // Cross-origin iframe - kann nicht von außen gestylt werden
              // console.log('HeyFlow verwendet ein Cross-Origin iframe. Der Hintergrund muss im HeyFlow-Dashboard konfiguriert werden.');
            }
          }
        }, 1000);
      }
    }
    
    // Beim Laden der Seite
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', setHeyFlowBackground);
    } else {
      setHeyFlowBackground();
    }
    
    // Beobachte Änderungen im DOM (für dynamisch geladene Widgets)
    const observer = new MutationObserver(function(mutations) {
      setHeyFlowBackground();
    });
    
    observer.observe(document.body, {
      childList: true,
      subtree: true
    });
  })();
</script>

<style>
  .heyflow-form {
    padding: var(--spacing-3xl) 0;
    background-color: #ffffff !important;
    background: #ffffff !important;
  }

  .heyflow-form__wrapper {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 var(--spacing-lg);
    display: flex;
    flex-direction: column;
    align-items: center;
    background-color: #ffffff;
  }

  .heyflow-form__heading {
    font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    font-size: 40px;
    font-weight: 400;
    margin-bottom: var(--spacing-xl);
    color: var(--color-text, #000000);
    text-align: center;
  }

  .heyflow-form__container {
    width: 100%;
    max-width: 800px;
    margin: 0 auto;
    background-color: #ffffff !important;
    background: #ffffff !important;
  }

  .heyflow-form__embed {
    width: 100%;
    max-width: 800px;
    margin: 0 auto;
    background-color: #ffffff !important;
    background: #ffffff !important;
  }

  /* HeyFlow Widget Styling */
  heyflow-wrapper {
    background-color: #ffffff !important;
    background: #ffffff !important;
    display: block;
  }

  heyflow-wrapper * {
    background-color: #ffffff !important;
    background: #ffffff !important;
  }

  heyflow-wrapper iframe {
    background-color: #ffffff !important;
    background: #ffffff !important;
  }

  .heyflow-form section,
  .heyflow-form div {
    background-color: #ffffff !important;
  }

  /* Überschreibe alle möglichen Hintergrundfarben */
  [class*="heyflow"],
  [id*="heyflow"] {
    background-color: #ffffff !important;
    background: #ffffff !important;
  }

  .heyflow-form__placeholder {
    padding: var(--spacing-xl);
    text-align: center;
    color: var(--color-text, #666666);
    font-family: 'Montserrat', sans-serif;
  }

  @media (max-width: 767px) {
    .heyflow-form {
      padding: var(--spacing-2xl) 0;
    }

    .heyflow-form__heading {
      font-size: 32px;
    }

    .heyflow-form__embed {
      max-width: 100%;
    }
  }
</style>

{% schema %}
{
  "name": "HeyFlow Form",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Überschrift",
      "default": ""
    },
    {
      "type": "text",
      "id": "flow_id",
      "label": "HeyFlow Flow ID",
      "default": "OXukvFlXlOj4Om7gpATS",
      "info": "Die Flow-ID aus Ihrem HeyFlow-Account"
    },
    {
      "type": "text",
      "id": "form_width",
      "label": "Formular Breite",
      "default": "800px",
      "info": "Breite des Formulars (z.B. 800px, 100%)"
    }
  ],
  "presets": [
    {
      "name": "HeyFlow Form"
    }
  ]
}
{% endschema %}

